{
  "info": {
    "name": "Payment Service API",
    "description": "API collection for testing Payment Service with VNPay integration",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3003"
    },
    {
      "key": "orderId",
      "value": "507f1f77bcf86cd799439011"
    },
    {
      "key": "paymentId",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "Create Payment",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 201) {",
              "    const response = pm.response.json();",
              "    pm.collectionVariables.set('paymentId', response.id);",
              "    pm.test('Payment created successfully', function () {",
              "        pm.expect(response).to.have.property('paymentUrl');",
              "        pm.expect(response.status).to.eql('pending');",
              "    });",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"orderId\": \"{{orderId}}\",\n  \"amount\": 50000,\n  \"bankCode\": \"NCB\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/payments",
          "host": ["{{baseUrl}}"],
          "path": ["api", "payments"]
        },
        "description": "Tạo payment mới cho đơn hàng. Cần authentication."
      }
    },
    {
      "name": "Get Payment by ID",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/payments/{{paymentId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "payments", "{{paymentId}}"]
        },
        "description": "Lấy thông tin payment theo ID"
      }
    },
    {
      "name": "Get Payment by Order ID",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/payments/order/{{orderId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "payments", "order", "{{orderId}}"]
        },
        "description": "Lấy thông tin payment theo Order ID"
      }
    },
    {
      "name": "VNPay Callback (Test)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/payments/vnpay-callback?vnp_Amount=5000000&vnp_BankCode=NCB&vnp_BankTranNo=VNP01&vnp_CardType=ATM&vnp_OrderInfo=Thanh toan don hang&vnp_PayDate=20240529173000&vnp_ResponseCode=00&vnp_TmnCode=TEST123&vnp_TransactionNo=14012345&vnp_TransactionStatus=00&vnp_TxnRef=test_123456&vnp_SecureHash=invalid_hash_for_testing",
          "host": ["{{baseUrl}}"],
          "path": ["api", "payments", "vnpay-callback"],
          "query": [
            {
              "key": "vnp_Amount",
              "value": "5000000"
            },
            {
              "key": "vnp_BankCode",
              "value": "NCB"
            },
            {
              "key": "vnp_BankTranNo",
              "value": "VNP01"
            },
            {
              "key": "vnp_CardType",
              "value": "ATM"
            },
            {
              "key": "vnp_OrderInfo",
              "value": "Thanh toan don hang"
            },
            {
              "key": "vnp_PayDate",
              "value": "20240529173000"
            },
            {
              "key": "vnp_ResponseCode",
              "value": "00"
            },
            {
              "key": "vnp_TmnCode",
              "value": "TEST123"
            },
            {
              "key": "vnp_TransactionNo",
              "value": "14012345"
            },
            {
              "key": "vnp_TransactionStatus",
              "value": "00"
            },
            {
              "key": "vnp_TxnRef",
              "value": "test_123456"
            },
            {
              "key": "vnp_SecureHash",
              "value": "invalid_hash_for_testing"
            }
          ]
        },
        "description": "Test VNPay callback endpoint (với hash không hợp lệ)"
      }
    },
    {
      "name": "VNPay IPN (Test)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"vnp_Amount\": \"5000000\",\n  \"vnp_BankCode\": \"NCB\",\n  \"vnp_BankTranNo\": \"VNP01\",\n  \"vnp_CardType\": \"ATM\",\n  \"vnp_OrderInfo\": \"Thanh toan don hang\",\n  \"vnp_PayDate\": \"20240529173000\",\n  \"vnp_ResponseCode\": \"00\",\n  \"vnp_TmnCode\": \"TEST123\",\n  \"vnp_TransactionNo\": \"14012345\",\n  \"vnp_TransactionStatus\": \"00\",\n  \"vnp_TxnRef\": \"test_123456\",\n  \"vnp_SecureHash\": \"invalid_hash_for_testing\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/payments/vnpay-ipn",
          "host": ["{{baseUrl}}"],
          "path": ["api", "payments", "vnpay-ipn"]
        },
        "description": "Test VNPay IPN endpoint"
      }
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Auto-generate JWT token for testing (simplified)",
          "const testJwt = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYwNzEyYzM5YjA5YzE0MDAxNWY0ZWQzNCIsImVtYWlsIjoidGVzdEBleGFtcGxlLmNvbSIsImlhdCI6MTYxODE2NzM1M30.test';",
          "",
          "pm.request.headers.add({",
          "    key: 'Cookie',",
          "    value: `session=${testJwt}`",
          "});"
        ]
      }
    }
  ]
}
